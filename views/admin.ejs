<head>
<title>NR v2 | Admin</title>
</head>

<link rel="stylesheet" type="text/css" href="css/style.css" />

<body>
<div id = 'superbigcontainer' onkeyup="customInput()">




  <div id='container'>

    <h1>Admin tool v1.0</h1>
    <div class = "menu">
     <button class="active"   id="create"       onclick="showclass('create')">Create</button>
     <button class="inactive" id="preview"      onclick="showclass('preview')">Preview</button>
     <button class="inactive" id="browse"       onclick="showclass('browse')">Browse</button>
     <button class="inactive" id="edit"         onclick="showclass('edit')">Edit</button>
     <button class="inactive" id="deploy"       onclick="showclass('deploy')">Deploy</button>
     </div>
   <div class = "content">

   <!-- CREATE tab :  enables to fetch and save a dataset in default/customized path-->
   <div  class="tab visible" id = "c">

       <h4 id="json">Dataset updated at: <span id='lastUpdate'>  <%= lastUpdate %>  </span></h4>
       <form method="post" action="/admin/refresh">
         <input type="submit" value="Get / Refresh dataset &#8635;"/>
       </form>

       <h4 id="json">Default dataset id: <span id=''>  <%= date %>  </span></h4>
       <p> URL (external) : <a target="_blank" href="https://newsapp-carb11.herokuapp.com/<%= date %>"/>https://newsapp-carb11.herokuapp.com/<%= date %></a><p>
       <p> URL (local) : <a target="_blank" href="localhost:5000/<%= date %>"/>localhost:5000/<%= date %></a><p>
       <form method="post" action="/admin/save/<%- date %>" >
         <input type="submit" value="Save dataset &#128190;"/>
       </form>

       <form method="post" action="" id="submitCustom" >
       <h4 id="json" >Customized dataset id: <input type="text" name="custom" id="customInput"  text=""> </input><span id="customButton" onclick="customInput()">&#9655;</span> </h4>
       <p> URL (external) : <a id="customExtUrl" target="_blank" href="https://newsapp-carb11.herokuapp.com/"/>https://newsapp-carb11.herokuapp.com/</a><p>
       <p> URL (local) : <a id="customLocalUrl" target="_blank" href="localhost:5000/"/>localhost:5000/</a><p>
       <input type="submit" value="Save custom path &#128190;" />
       </form>

     </div>

  <!--PREVIEW tab-->
   <div  class="tab hidden" id = "p">

     <b>Sources(<%- resultArray.length %>)</b>
     <p id="json-content"><%- JSON.stringify(resultObject) %><p>

     </div>

  <!--BROWSE tab :  -->
   <div  class="tab hidden" id = "b">
     <a href="">reload page</a>
     <ul id="viewDirs">
     </ul>
   </div>

   <!--EDIT tab-->
   <div  class="tab hidden" id = "e">
     <p class = "link" onclick= "showclass('browse')">Browse</p>
     or
     <p id="">Edit current dataset:</p>
   </div>

   <!--DEPLOY tab : I don't know yet what I'll use it for...-->
   <div  class="tab hidden" id = "d">
     deploy
   </div>


  </div>


    <div id ="more">
      <div id="git">Suivez ce projet sur <a href="https://github.com/Carburator11">Github</a></div>
      <div id="ln">Mon profil <a href="https://www.linkedin.com/in/pierrevautherin/">LinkedIn</a></div>
      <div id="v1">La premi√®re version de ce site : <a href="http://carb11.eu/newsroom/">Newsroom v1.0</a></div>
    </div>
  </div>

  </div>
</div>
</body>

<script>






//generates the URLs
var customId = document.getElementById('customInput').value;
function customInput(){
      customId = document.getElementById('customInput').value;
      document.getElementById("customExtUrl").href = "https://newsapp-carb11.herokuapp.com/" + customId ;
      document.getElementById("customExtUrl").innerHTML = "https://newsapp-carb11.herokuapp.com/" + customId ;
      document.getElementById("customLocalUrl").href = "localhost:5000/" + customId ;
      document.getElementById("customLocalUrl").innerHTML = "localhost:5000/" + customId ;
      document.getElementById("submitCustom").action = "/admin/save/"+ customId;
  }


//ugly solution... could have used Jquery toggleclasses but I don't want too many external modules on this project
function showclass(e){
      document.getElementById("create").className =  "inactive";
      document.getElementById("preview").className = "inactive";
      document.getElementById("browse").className =  "inactive";
      document.getElementById("edit").className =    "inactive";
      document.getElementById("deploy").className =  "inactive";
      document.getElementById(e).className =         "active";

      document.getElementById('c').className = "tab hidden";
      document.getElementById('p').className = "tab hidden";
      document.getElementById('b').className = "tab hidden";
      document.getElementById('e').className = "tab hidden";
      document.getElementById('d').className = "tab hidden";
      document.getElementById(e.substring(0,1)).className = "tab visible";

      sessionStorage.setItem("lastview", e);
      //storing last page viewed in sessionStorage
}


//this function populates the BROWSE tab
//function is called below
function showDirList(){
  document.getElementById('viewDirs').innerHTML = ""; //initializing

  for (var i = 0 ; i < <%- JSON.stringify(dirList)%>.length ; i++) {
    var filename = <%- JSON.stringify(dirList)%>[i];
    var id =  filename.substring(0, (filename.length - 5));


    var el = "<li>" + filename + "<span class = 'link' onclick= 'edit("+ id +")'>edit</span>";
    el    +=  "<a href='http://localhost:5000/admin/suppr/"+ id +"'>suppr.(local)</a>";
    el    +=  "<a href='https://newsapp-carb11.herokuapp.com/admin/suppr/"+ id +"'>suppr.(ext)</a>";
    el    +=  "</li>";
    document.getElementById('viewDirs').innerHTML += el ;
      }
}

function edit(e){
    //to be continued
    showclass("edit");
}


showDirList();
showclass(sessionStorage.getItem("lastview"));



</script>
